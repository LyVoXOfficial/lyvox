# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ React Error #310

## üìÖ –î–∞—Ç–∞: 4 –Ω–æ—è–±—Ä—è 2025, 20:17

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞:** React Error #310 - "Too many re-renders"

```
Uncaught Error: Minified React error #310
at aE (eb3dbc1eb1858a09.js:19:62966)
at a1 (eb3dbc1eb1858a09.js:19:69423)
at Object.a3 [as useEffect] (eb3dbc1eb1858a09.js:19:69648)
```

### –ü—Ä–∏—á–∏–Ω–∞

`useEffect` –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω **–≤–Ω—É—Ç—Ä–∏ —É—Å–ª–æ–≤–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞** (`if (currentStep === 7)`), —á—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç **Rules of Hooks** –≤ React:

```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - useEffect –≤–Ω—É—Ç—Ä–∏ —É—Å–ª–æ–≤–∏—è
if (currentStep === 7) {
  useEffect(() => {
    // ...
  }, [dependencies]);
  
  return <Card>...</Card>;
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
1. Hooks –¥–æ–ª–∂–Ω—ã –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –Ω–∞ **–≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
2. Hooks –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–Ω—É—Ç—Ä–∏ —É—Å–ª–æ–≤–∏–π, —Ü–∏–∫–ª–æ–≤ –∏–ª–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
3. –≠—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ü–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏ `useEffect` –Ω–∞ –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å

```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - useEffect –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ
export function PostForm({ ... }) {
  // ... –≤—Å–µ useState
  
  const draftCreationInProgress = useRef(false);
  
  // ... –¥—Ä—É–≥–∏–µ useEffect'—ã
  
  // Auto-create draft when reaching step 7
  useEffect(() => {
    if (currentStep === 7 && !advertId && !isLoading && !draftCreationInProgress.current) {
      draftCreationInProgress.current = true;
      const createDraft = async () => {
        try {
          await ensureAdvertId();
          toast.success(t("post.draft_created") || "–ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ–∑–¥–∞–Ω");
        } catch (error: any) {
          toast.error(t("post.update_error") || "–û—à–∏–±–∫–∞", { 
            description: error.message 
          });
        } finally {
          draftCreationInProgress.current = false;
        }
      };
      createDraft();
    }
  }, [currentStep, advertId, isLoading, t]);
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
  
  // Step 7 —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ë–ï–ó useEffect –≤–Ω—É—Ç—Ä–∏
  if (currentStep === 7) {
    return <Card>...</Card>;
  }
}
```

### 2. –î–æ–±–∞–≤–∏–ª–∏ `useRef` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
const draftCreationInProgress = useRef(false);
```

–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–∞, –µ—Å–ª–∏ `useEffect` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤–Ω—É—Ç—Ä–∏ `useEffect`

```typescript
if (currentStep === 7 && !advertId && !isLoading && !draftCreationInProgress.current) {
  // —Å–æ–∑–¥–∞—ë–º —á–µ—Ä–Ω–æ–≤–∏–∫ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
  // - –º—ã –Ω–∞ —à–∞–≥–µ 7
  // - —á–µ—Ä–Ω–æ–≤–∏–∫ –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω
  // - –Ω–µ –∏–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∞
  // - –Ω–µ –∏–¥—ë—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è
}
```

### 4. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```typescript
}, [currentStep, advertId, isLoading, t]);
```

---

## üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–π —Ñ–∞–π–ª

**–§–∞–π–ª:** `apps/web/src/app/post/PostForm.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤–ª–µ–Ω `useRef` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 106)
2. –ü–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏ `useEffect` –Ω–∞ –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å (—Å—Ç—Ä–æ–∫–∏ 307-324)
3. –£–¥–∞–ª–∏–ª–∏ `useEffect` –∏–∑ —É—Å–ª–æ–≤–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —à–∞–≥–∞ 7

---

## üöÄ –î–µ–ø–ª–æ–π

**–ö–æ–º–º–∏—Ç:** `3258012`  
**–°–æ–æ–±—â–µ–Ω–∏–µ:** "fix: resolve React Error #310 - move useEffect to top level"

**–°—Ç–∞—Ç—É—Å:**
- ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã (22/22)
- ‚úÖ –ö–æ–º–º–∏—Ç —Å–æ–∑–¥–∞–Ω
- ‚úÖ –ó–∞–ø—É—à–µ–Ω–æ –Ω–∞ GitHub
- ‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ Vercel

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è: `/post`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É —à–∞–≥ –∑–∞ —à–∞–≥–æ–º
3. –î–æ–π–¥–∏—Ç–µ –¥–æ **—à–∞–≥–∞ 7** (–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ)
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
   - ‚úÖ –ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ)
   - ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
   - ‚úÖ –ù–µ—Ç –æ—à–∏–±–∫–∏ #310 –≤ –∫–æ–Ω—Å–æ–ª–∏
   - ‚úÖ –ù–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
5. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
6. –ó–∞–≤–µ—Ä—à–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è

---

## üìö –ü—Ä–∞–≤–∏–ª–∞ React Hooks

**–ß—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å:**

### ‚úÖ DO (–ü—Ä–∞–≤–∏–ª—å–Ω–æ)

```typescript
function Component() {
  // –í—Å–µ —Ö—É–∫–∏ –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ
  const [state, setState] = useState(initialValue);
  useEffect(() => {
    // —É—Å–ª–æ–≤–∏—è –í–ù–£–¢–†–ò useEffect
    if (condition) {
      // ...
    }
  }, [dependencies]);
  
  // —É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
  if (someCondition) {
    return <div>...</div>;
  }
  
  return <div>...</div>;
}
```

### ‚ùå DON'T (–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)

```typescript
function Component() {
  const [state, setState] = useState(initialValue);
  
  // ‚ùå –•—É–∫ –≤–Ω—É—Ç—Ä–∏ —É—Å–ª–æ–≤–∏—è
  if (someCondition) {
    useEffect(() => {
      // ...
    }, [dependencies]);
  }
  
  // ‚ùå –•—É–∫ –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞
  for (let i = 0; i < 10; i++) {
    useEffect(() => {
      // ...
    }, [dependencies]);
  }
  
  return <div>...</div>;
}
```

---

## ‚úÖ –ò—Ç–æ–≥

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å |
|----------|--------|
| React Error #310 (Too many re-renders) | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** |
| useEffect –≤–Ω—É—Ç—Ä–∏ —É—Å–ª–æ–≤–∏—è | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** |
| –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ | ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** |

---

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!** üéâ

**–ö–æ–º–º–∏—Ç:** `3258012`  
**–î–∞—Ç–∞:** 4 –Ω–æ—è–±—Ä—è 2025, 20:17  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

